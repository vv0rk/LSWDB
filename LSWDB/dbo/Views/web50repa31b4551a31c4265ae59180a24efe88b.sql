CREATE VIEW dbo.web50repa31b4551a31c4265ae59180a24efe88b AS Select Top 1000000 r.AssetId As Asset, ac.Custom1 As N'Организация', ac.Custom2 As N'Город', ac.Custom3 As N'Адрес', ac.Custom4 As N'Офис', s.ScladName As N'Склад', ac.Custom19 As N'ФИО ответственного ВТшника', r.*, ts.Statename As N'Статус', remain.rem As N'Остатки %' From rMaterialSvod As r Inner Join tblAssetCustom As ac On r.AssetId = ac.AssetID Inner Join tblState As ts On ac.State = ts.State Left Join rAssetsScladLink As asl On r.AssetId = asl.AssetID Left Join rSclad As s On asl.IdSclad = s.Id Left Join (Select r.Id, Cast(Case When cdp.TonerRemaining > 0 And cdp.TonerMaximum > 0 Then cdp.TonerRemaining / cdp.TonerMaximum * 100 Else 0 End As int) As rem From rMaterialSvod As r Inner Join tblAssetCustom As ac On r.AssetId = ac.AssetID Inner Join tblState As ts On ac.State = ts.State Left Join rAssetsScladLink As asl On r.AssetId = asl.AssetID Left Join rSclad As s On asl.IdSclad = s.Id Inner Join rMaterialOriginal As mo On r.PartNumber = mo.PartNumber Inner Join rModelDevice As md On r.ModelSprav = md.Model Inner Join rMaterialRemainLink As mrl On md.Id = mrl.idModel And mo.Id = mrl.idMaterialOriginal Inner Join tblCustDevPrinter As cdp On r.AssetId = cdp.AssetID And mrl.TonerName = cdp.Tonername And mrl.TonerColorName = cdp.TonerColorName) As remain On r.Id = remain.Id Order By N'Город', N'Организация', r.IdSclad, Asset