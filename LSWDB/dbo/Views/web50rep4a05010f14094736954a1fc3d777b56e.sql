CREATE VIEW dbo.web50rep4a05010f14094736954a1fc3d777b56e AS Select Top 1000000 S.org As [Родительская организация], S.Custom1 As [Филиал/отделение], S.softwareName As softwareName, '' As SoftwareVersion, Count(S.AssetName) As [Кол-во установок], L.softwareName As [Название краткое], L.LicenseOwner As Производитель, Max(SLO.Nrlicenses) As [Кол-во лицензий] From (Select RC.Parent As org, A.AssetName As AssetName, SU.softwareName As softwareName, S.softwareVersion As softwareVersion, AC.Custom1 As Custom1, SU.Approved As Approved From tblSoftware As S Inner Join tblAssets As A On S.AssetID = A.AssetID Inner Join tblAssetCustom As AC On A.AssetID = AC.AssetID Inner Join tblSoftwareUni As SU On S.softID = SU.SoftID Left Join rCompany$ As RC On AC.Custom1 = RC.Code) As S Inner Join tblSublicenses As SL On S.softwareName = SL.softwareName And S.softwareVersion = SL.softwareVersion Left Join tblSublicensesOrders As SLO On SL.LicenseidID = SLO.LicenseidID And S.org = Cast(SLO.Comments As nvarchar(100)) Left Join tblLicenses As L On SL.LicenseidID = L.LicenseidID Group By S.org, S.Custom1, S.softwareName, L.softwareName, L.LicenseOwner