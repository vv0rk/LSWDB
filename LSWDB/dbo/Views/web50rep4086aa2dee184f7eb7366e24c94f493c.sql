CREATE VIEW dbo.web50rep4086aa2dee184f7eb7366e24c94f493c AS Select Top 1000000 Su.SoftwarePublisher As Производитель, Su.softwareName As [Наименование ПО], S.softwareVersion As [Версия ПО], Count(A.AssetName) As [Кол-во установок] From tblSoftwareUni As Su Inner Join tblSoftware As S On Su.SoftID = S.softID Inner Join tblAssetCustom As AC On S.AssetID = AC.AssetID Inner Join tblAssets As A On AC.AssetID = A.AssetID Left Join rCompany$ As RC On AC.Custom1 = RC.Code Where Su.Approved = '1' And Not Exists(Select Su.softwareName, S.softwareVersion From (Select sl.softwareName As sName, sl.softwareVersion As sVersion, L.softwareName As SoftwareName, L.LicenseOwner As LicenseOwner From tblSublicenses As sl Inner Join tblLicenses As L On sl.LicenseidID = L.LicenseidID) As slo1 Where slo1.sName = Su.softwareName And slo1.sVersion = S.softwareVersion) Group By Su.SoftwarePublisher, Su.softwareName, S.softwareVersion