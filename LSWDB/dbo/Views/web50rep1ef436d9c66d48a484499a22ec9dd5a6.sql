CREATE VIEW dbo.web50rep1ef436d9c66d48a484499a22ec9dd5a6 AS SELECT TOP 1000000  * From (Select rc.Parent, ac.Custom1, lic.LicenseOwner, su.softwareName, '' As N'Кол-во лицензий', N'ДА' As N'Требуется лицензий', '' As N'SKU', lic.SoftName As N'Рекомендуемая номенклатура', 1 As N'Количество рекомендуемое', ac.Custom11 As N'Пользователь', a.AssetName As N'Название ПК', a.AssetID As AssetID, st.Statename As N'Статус', ac.Custom19 As N'ФИО ответственный ВТшник', lic.SoftName + Convert(nvarchar(20),a.AssetID) As N'Ключ составной', Row_Number() Over (Partition By lic.SoftName + Convert(nvarchar(20),a.AssetID) Order By a.AssetID Desc) As rn From tblSoftware As s Inner Join tblSoftwareUni As su On s.softID = su.SoftID Inner Join tblAssetCustom As ac On s.AssetID = ac.AssetID Inner Join tblAssets As a On ac.AssetID = a.AssetID Inner Join tblState As st On ac.State = st.State Inner Join rCompany$ As rc On ac.Custom1 = rc.Code Inner Join (Select sl.softwareName, sl.softwareVersion, l.softwareName As SoftName, l.LicenseOwner As LicenseOwner From tblSublicenses As sl Inner Join tblLicenses As l On sl.LicenseidID = l.LicenseidID) As lic On su.softwareName = lic.softwareName And s.softwareVersion = lic.softwareVersion) As lll Where lll.rn = 1