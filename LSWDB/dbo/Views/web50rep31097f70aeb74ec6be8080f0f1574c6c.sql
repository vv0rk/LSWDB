CREATE VIEW dbo.web50rep31097f70aeb74ec6be8080f0f1574c6c AS Select Top 1000000 RC.Parent As [Родительская организация], AC.Custom1 As [Филиал/отделение], Su.softwareName, S.softwareVersion, Count(A.AssetName) As [Кол-во установок], slo1.SoftwareName As [Название ПО], slo1.LicenseOwner As Производитель, slo.NrLicenses As [Кол-во лицензий] From tblSoftwareUni As Su Inner Join tblSoftware As S On Su.SoftID = S.softID Inner Join tblAssetCustom As AC On S.AssetID = AC.AssetID Inner Join tblAssets As A On AC.AssetID = A.AssetID Left Join rCompany$ As RC On AC.Custom1 = RC.Code Left Join (Select slo.Comments As sOrg, sl.softwareName As sName, sl.softwareVersion As sVersion, slo.Nrlicenses As NrLicenses, L.softwareName As SoftwareName, L.LicenseOwner As LicenseOwner From tblSublicenses As sl Inner Join tblSublicensesOrders As slo On sl.LicenseidID = slo.LicenseidID Inner Join tblLicenses As L On sl.LicenseidID = L.LicenseidID) As slo On slo.sName = Su.softwareName And slo.sVersion = S.softwareVersion And Cast(slo.sOrg As nvarchar(100)) = RC.Parent Inner Join (Select sl.softwareName As sName, sl.softwareVersion As sVersion, L.softwareName As SoftwareName, L.LicenseOwner As LicenseOwner From tblSublicenses As sl Inner Join tblLicenses As L On sl.LicenseidID = L.LicenseidID) As slo1 On slo1.sName = Su.softwareName And slo1.sVersion = S.softwareVersion Group By RC.Parent, AC.Custom1, Su.softwareName, S.softwareVersion, slo1.SoftwareName, slo1.LicenseOwner, slo.NrLicenses Order By [Родительская организация], [Филиал/отделение], Производитель, [Название ПО]