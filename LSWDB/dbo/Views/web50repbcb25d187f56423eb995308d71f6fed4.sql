CREATE VIEW dbo.web50repbcb25d187f56423eb995308d71f6fed4 AS SELECT TOP 1000000  ac.Custom1 As 'Организация', a.AssetName As N'Название ПК', IsNull(aa.NMonitor, 0) As N'Кол-во мониторов' From tblAssets As a Inner Join tblAssetCustom As ac On a.AssetID = ac.AssetID Left Join (Select ac.Custom1 As 'Организация', a.AssetName As N'Название ПК', a.AssetID, Count(arc.AssetName) As NMonitor From tblAssets As a Inner Join tblAssetCustom As ac On a.AssetID = ac.AssetID Inner Join tsysAssetTypes On tsysAssetTypes.AssetType = a.Assettype Left Join tblAssetRelations As ar On ac.AssetID = ar.ParentAssetID Left Join tblAssets As arc On ar.ChildAssetID = arc.AssetID Left Join tsysAssetTypes As atc On arc.Assettype = atc.AssetType Where tsysAssetTypes.AssetTypename = 'Windows' And atc.AssetTypename = 'Monitor' Group By ac.Custom1, a.AssetName, a.AssetID) As aa On a.AssetID = aa.AssetID Order By N'Кол-во мониторов' Desc