CREATE VIEW dbo.web50rep8fbfa2be68254cb59fe1258ecd18fccf AS Select Top 1000000 S.org As [Родительская организация], S.Custom1 As [Филиал/отделение], S.softwareName As softwareName, '' As SoftwareVersion, Count(S.AssetName) As [Кол-во установок], L.softwareName As [Название краткое], L.LicenseOwner As Производитель, Max(SLO.Nrlicenses) As [Кол-во лицензий], S.Name As [Имя пользователя], S.AssetName As [Имя ПК], S.Custom2 As Адрес, S.Custom3 As Офис, S.Custom19 As [Ответственный ВТшник] From (Select RC.Parent As org, A.AssetName As AssetName, SU.softwareName As softwareName, S.softwareVersion As softwareVersion, AC.Custom1 As Custom1, AC.Custom2 As Custom2, AC.Custom3 As Custom3, SU.Approved As Approved, adu.name As Name, AC.Custom19 As Custom19 From tblSoftware As S Inner Join tblAssets As A On S.AssetID = A.AssetID Inner Join tblAssetCustom As AC On A.AssetID = AC.AssetID Inner Join tblSoftwareUni As SU On S.softID = SU.SoftID Left Join rCompany$ As RC On AC.Custom1 = RC.Code Left Join (Select adu.Username As username, adu.Name As name From tblADusers As adu Inner Join (Select Distinct adu.Username As username, Max(adu.ADUserID) As id From tblADusers As adu Group By adu.Username) As addu On adu.ADUserID = addu.id) As adu On A.Username = adu.username) As S Inner Join tblSublicenses As SL On S.softwareName = SL.softwareName And S.softwareVersion = SL.softwareVersion Left Join tblSublicensesOrders As SLO On SL.LicenseidID = SLO.LicenseidID And S.org = Cast(SLO.Comments As nvarchar(100)) Left Join tblLicenses As L On SL.LicenseidID = L.LicenseidID Group By S.org, S.Custom1, S.softwareName, L.softwareName, L.LicenseOwner, S.Name, S.AssetName, S.Custom2, S.Custom3, S.Custom19