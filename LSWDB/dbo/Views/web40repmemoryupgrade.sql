CREATE VIEW dbo.web40repmemoryupgrade AS Select Top 1000000 tsysOS.Image As Icon, tblAssets.AssetID, tblAssets.AssetUnique, tblAssets.Domain, tsysOS.OSname, Ceiling(tblPhysicalMemoryArray.MaxCapacity / 1024) As MaxCapacity, CorrectMemory.Memory, Cast(CorrectMemory.Used As numeric) As [Slots  used], tblPhysicalMemoryArray.MemoryDevices As [Slots available], tblPhysicalMemoryArray.MemoryDevices - CorrectMemory.Used As [Slots free], tblAssetCustom.Custom1 As Организация From tblAssets Inner Join tblPhysicalMemoryArray On tblAssets.AssetID = tblPhysicalMemoryArray.AssetID Inner Join (Select tblAssets.AssetID, Sum(Ceiling(tblPhysicalMemory.Capacity / 1024 / 1024)) As Memory, Count(tblPhysicalMemory.Win32_PhysicalMemoryid) As Used From tblAssets Left Outer Join (TsysMemorytypes Right Outer Join tblPhysicalMemory On TsysMemorytypes.Memorytype = tblPhysicalMemory.MemoryType) On tblAssets.AssetID = tblPhysicalMemory.AssetID Group By tblAssets.AssetID, tblPhysicalMemory.MemoryType Having tblPhysicalMemory.MemoryType <> 11) CorrectMemory On CorrectMemory.AssetID = tblAssets.AssetID And Ceiling(tblPhysicalMemoryArray.MaxCapacity / 1024) > CorrectMemory.Memory And Ceiling(tblPhysicalMemoryArray.MaxCapacity / 1024) > CorrectMemory.Memory Inner Join tblAssetCustom On tblAssets.AssetID = tblAssetCustom.AssetID Inner Join tsysOS On tblAssets.OScode = tsysOS.OScode Where (tblPhysicalMemoryArray.MemoryDevices - CorrectMemory.Used > 0) And tblPhysicalMemoryArray.[Use] = 3 And tblAssetCustom.State = 1 Order By [Slots free] Desc, tblAssets.AssetName