CREATE VIEW dbo.web50rep632a1bbcb1f54a35b970c61bf2bd8678 AS Select Top 1000000 r.AssetId As Asset, ac.Custom1 As N'Организация', ac.Custom2 As N'Город', ac.Custom3 As N'Адрес', ac.Custom4 As N'Офис', s.ScladName As N'Склад', ac.Custom19 As N'ФИО ответственного ВТшника', aa.IPAddress, r.ModelSprav, r.ModelAsset, r.PartNumber, r.Resource, r.Januar, r.Februar, r.March, r.April, r.May, r.June, r.July, r.August, r.September, r.October, r.November, r.December, r.IdSclad, Coalesce(remain.rem, 100) As PercentRes, r.ScladRemain, r.Intence, ts.Statename As N'Статус' From rMaterialSvod As r Inner Join tblAssetCustom As ac On r.AssetId = ac.AssetID Inner Join tblAssets As aa On ac.AssetID = aa.AssetID Inner Join tblState As ts On ac.State = ts.State Left Join rAssetsScladLink As asl On r.AssetId = asl.AssetID Left Join rSclad As s On asl.IdSclad = s.Id Left Join (Select r.Id, Cast(Case When cdp.TonerRemaining > 0 And cdp.TonerMaximum > 0 Then cdp.TonerRemaining / cdp.TonerMaximum * 100 When cdp.TonerRemaining = -3 Then 100 Else 0 End As int) As rem From rMaterialSvod As r Inner Join tblAssetCustom As ac On r.AssetId = ac.AssetID Inner Join tblState As ts On ac.State = ts.State Left Join rAssetsScladLink As asl On r.AssetId = asl.AssetID Left Join rSclad As s On asl.IdSclad = s.Id Inner Join rMaterialOriginal As mo On r.PartNumber = mo.PartNumber Inner Join rModelDevice As md On r.ModelSprav = md.Model Inner Join rMaterialRemainLink As mrl On md.Id = mrl.idModel And mo.Id = mrl.idMaterialOriginal Inner Join tblCustDevPrinter As cdp On r.AssetId = cdp.AssetID And mrl.TonerName = cdp.Tonername And mrl.TonerColorName = cdp.TonerColorName) As remain On r.Id = remain.Id Where ts.Statename Like '%ctive' Order By N'Город', N'Организация', r.IdSclad, Asset